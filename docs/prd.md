# Christmas-tree - Product Requirements Document

**Author:** Gianni
**Date:** 2025-12-01
**Version:** 1.0

---

## Executive Summary

Christmas-tree 是一个 3D 交互式 Web 应用，将节日氛围与个人记忆完美融合。用户首先看到一个由粒子构成的旋转圣诞树，点击后触发震撼的粒子爆炸效果，粒子随即变形为漂浮的 Polaroid 照片，形成一个可交互的 3D 照片墙。这个项目旨在创造一个情感旅程——从惊喜的视觉冲击到温暖的记忆回顾，为朋友和家人提供一种独特的数字记忆分享方式。

### What Makes This Special

**独特的情感化交互设计：** 通过物理驱动的粒子动画，将节日象征（圣诞树）与个人记忆（照片）无缝连接，创造出一个既有视觉冲击力又有情感共鸣的体验。核心创新在于三阶段的情感旅程设计：
1. **惊喜阶段** - 高速粒子爆炸带来的视觉震撼
2. **沉浸阶段** - 相机自动推进，用户被记忆云包围
3. **回忆阶段** - 交互式浏览漂浮的照片，每张照片都可以放大查看

这种从"爆炸"到"漂浮"再到"聚焦"的设计，模拟了人类回忆的心理过程——从突然涌现到平静回味。

---

## Project Classification

**Technical Type:** web_app
**Domain:** creative_entertainment
**Complexity:** medium

这是一个基于现代 Web 技术栈（React + TypeScript + Three.js/React-Three-Fiber）的 3D 交互式应用。项目需要复杂的粒子系统、物理模拟和 3D 渲染能力，但不涉及后端服务、数据库或复杂的业务逻辑。所有数据（照片）都在客户端加载和处理。

**技术复杂度来源：**
- 高性能粒子系统（数千个粒子的实时渲染）
- 复杂的状态转换动画（树形态 → 爆炸 → 照片形态）
- 3D 物理模拟（爆炸速度、阻尼、漂浮运动）
- 自定义 GLSL 着色器（粒子渲染和形态变换）
- 性能优化（保持 60fps 的流畅体验）

---

## Success Criteria

**用户体验成功指标：**
- **情感共鸣：** 用户在体验后表达"惊喜"和"温暖"的情感反馈
- **交互完成度：** 90% 的用户完成完整的交互流程（点击树 → 浏览照片 → 查看至少一张照片详情）
- **分享意愿：** 用户主动分享给朋友和家人

**技术性能指标：**
- **流畅度：** 在主流设备上保持 60fps（桌面）/ 30fps（移动端）
- **加载速度：** 首次加载时间 < 3 秒（包含所有照片资源）
- **兼容性：** 支持主流现代浏览器（Chrome, Firefox, Safari, Edge 最新两个版本）

**核心价值实现：**
成功意味着用户体验到完整的情感旅程——从视觉惊喜到记忆回顾，并感受到这是一种独特的、值得分享的记忆展示方式。

---

## Product Scope

### MVP - Minimum Viable Product

**核心交互流程：**
1. **初始状态：** 用户看到一个由粒子构成的旋转圣诞树，底部有简单的控制面板（颜色选择、粒子数量调整）
2. **爆炸触发：** 用户点击圣诞树，触发粒子爆炸效果
3. **形态转换：** 粒子在爆炸后变形为 Polaroid 照片卡片
4. **漂浮状态：** 照片在 3D 空间中漂浮，带有缓慢的旋转动画
5. **相机推进：** 相机自动向照片云中心移动，增强沉浸感
6. **照片交互：** 用户可以点击单张照片，照片放大至屏幕中心（Lightbox 模式）
7. **返回功能：** 用户可以关闭 Lightbox，或通过"返回"按钮将照片重新聚合成圣诞树

**必需的视觉效果：**
- 粒子系统渲染（支持自定义颜色）
- 爆炸物理效果（径向扩散 + 阻尼）
- 粒子到照片的形态变换（缩放 + 纹理交叉淡入）
- 照片的双面纹理（正反面都显示照片内容）
- 漂浮动画（3D 旋转 + 位置漂移）
- Lightbox 模式（背景模糊/变暗）

**基础控制功能：**
- 颜色主题切换（预设的配色方案）
- 粒子数量调整
- 相机旋转控制（鼠标拖拽）

**技术要求：**
- 使用 React + TypeScript + Three.js/React-Three-Fiber
- 支持桌面浏览器（Chrome, Firefox, Safari, Edge）
- 基本的性能优化（保持可用的帧率）

### Growth Features (Post-MVP)

**增强的交互体验：**
- **磁性悬停：** 鼠标悬停时，照片减速旋转并轻微放大（1.1x），防止用户"追逐"移动目标
- **时间倒流：** 允许用户通过"返回"按钮或长按空白区域，将照片"内爆"回圣诞树形态（逆向动画）
- **沉浸模式：** 爆炸触发时，所有 UI 控件淡出，给记忆 100% 的屏幕空间；重新组装树时 UI 重新出现
- **氛围切换：** 根据当前状态调整后期处理效果
  - 树状态：锐利、高对比度、"清冷冬夜"氛围
  - 记忆状态：柔焦、高光晕、略微温暖的色调、"梦幻怀旧"氛围

**高级视觉效果：**
- 音效支持（可选）：爆炸时的玻璃破碎声或魔法铃声
- 空间尘埃视差效果：增强深度感
- 更丰富的粒子效果（光晕、拖尾）

**用户自定义：**
- 用户上传自己的照片集
- 自定义颜色方案（色盘选择器）
- 调整动画速度和强度

### Vision (Future)

**社交分享功能：**
- 生成可分享的链接，包含用户的照片集和配置
- 导出为视频或 GIF 动画

**多主题支持：**
- 不同节日主题（新年、生日、纪念日等）
- 不同的初始形态（不仅限于圣诞树）

**AR/VR 支持：**
- WebXR 集成，在 VR 头显中体验
- AR 模式，在真实空间中投影照片墙

**协作功能：**
- 多人共同贡献照片到同一个记忆墙
- 实时协作浏览

---

## Web Application Specific Requirements

**技术栈要求：**
- **前端框架：** React 18+ with TypeScript
- **3D 渲染：** Three.js / React-Three-Fiber
- **构建工具：** Vite（已使用）
- **状态管理：** React hooks（useState, useRef, useEffect）
- **样式方案：** CSS Modules 或 Tailwind CSS

**浏览器兼容性：**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+
- 必须支持 WebGL 2.0

**性能目标：**
- 首次内容绘制（FCP）< 1.5 秒
- 最大内容绘制（LCP）< 2.5 秒
- 交互延迟（FID）< 100 毫秒
- 累积布局偏移（CLS）< 0.1

**资源管理：**
- 照片资源预加载机制
- 纹理压缩和优化
- 按需加载非关键资源
- 内存管理（避免内存泄漏）

**部署要求：**
- 静态站点部署（无需后端服务器）
- 支持 CDN 分发
- HTTPS 支持

---

## User Experience Principles

**设计哲学：**
本项目遵循"情感优先"的设计理念，通过精心设计的动画和交互，引导用户经历一个完整的情感旅程。详细的 UX 设计规范见 `docs/ux-design-specification.md`。

**核心 UX 原则：**

1. **可变节奏（Variable Pacing）：** 体验依赖于爆炸的瞬间能量和记忆漂浮的永恒感之间的对比
2. **隐形引导（Invisible Hand）：** 无需教程，通过磁性悬停和相机运动巧妙引导注意力
3. **策划路径（Curated Path）：** 用户是探索者而非编辑者，路径固定但探索自由
4. **电影化反馈（Cinematic Response）：** 环境本身响应（光晕、缩放、光效）而非 UI 元素

**设计系统：**
- **主题：** Midnight Magic（午夜魔法）
- **主色：** #D53F8C（霓虹粉）
- **辅色：** #805AD5（电紫）
- **强调色：** #38B2AC（青绿）
- **背景：** #1A202C（深灰蓝）
- **字体：** Inter（Google Fonts）

### Key Interactions

**三阶段交互模式：**

1. **预期（Anticipation）：**
   - 悬停在树上时，粒子轻微震动或发光
   - 光标变为指针，暗示可点击

2. **释放（Release）：**
   - 点击触发瞬间高速径向爆炸
   - 可选音效（玻璃破碎或魔法铃声）

3. **变形（Morph）：**
   - 速度阻尼（0.5-1.5 秒）
   - 粒子先放大到卡片尺寸，然后交叉淡入照片纹理

4. **漂移（Drift）：**
   - 相机缓慢移向中心
   - 照片带有"太空尘埃"视差效果增强深度

5. **捕获（Capture）：**
   - 磁性悬停：悬停的照片减速旋转并轻微放大（1.1x）
   - 防止用户"追逐"移动目标的挫败感

**沉浸模式：**
- 爆炸触发时，所有非叙事性 UI（控件、滑块）淡出（opacity: 0）
- 100% 屏幕空间用于记忆展示
- 只有在树完全重新组装后 UI 才重新出现

**氛围切换：**
- **树阶段：** 锐利、高对比度、"清冷冬夜"
- **记忆阶段：** 柔焦、高光晕、略微温暖的色调、"梦幻怀旧"

---

## Functional Requirements

### 视觉展示与渲染

**FR1:** 系统能够渲染由数千个粒子组成的 3D 圣诞树形态

**FR2:** 系统能够为粒子应用用户选择的颜色主题

**FR3:** 系统能够在树形态下持续旋转显示（自动旋转动画）

**FR4:** 系统能够渲染双面纹理的 Polaroid 照片卡片（正反面都显示照片）

**FR5:** 系统能够在 3D 空间中渲染多个漂浮的照片对象

**FR6:** 系统能够应用实时光照和阴影效果以增强深度感

**FR7:** 系统能够根据当前状态（树/记忆）切换后期处理效果（对比度、光晕、色调）

### 核心交互流程

**FR8:** 用户可以通过点击圣诞树触发粒子爆炸效果

**FR9:** 系统能够执行高速径向粒子爆炸动画，带有物理阻尼效果

**FR10:** 系统能够在爆炸过程中将粒子形态平滑转换为照片卡片（缩放 + 纹理交叉淡入）

**FR11:** 系统能够在形态转换完成后，使照片进入漂浮状态（3D 旋转 + 位置漂移）

**FR12:** 系统能够在爆炸触发时自动隐藏所有 UI 控件（沉浸模式）

**FR13:** 用户可以通过"返回"按钮或特定手势触发照片内爆回树形态的逆向动画

**FR14:** 系统能够在树重新组装完成后恢复 UI 控件显示

### 照片浏览与查看

**FR15:** 用户可以在 3D 空间中自由浏览漂浮的照片

**FR16:** 系统能够在用户悬停照片时应用磁性效果（减速旋转 + 轻微放大 1.1x）

**FR17:** 用户可以点击单张照片进入 Lightbox 查看模式

**FR18:** 系统能够在 Lightbox 模式下将选中照片平滑移动并放大至屏幕中心

**FR19:** 系统能够在 Lightbox 模式下模糊/变暗背景中的其他照片

**FR20:** 用户可以通过点击关闭按钮或背景区域退出 Lightbox 模式

**FR21:** 系统能够在退出 Lightbox 时将照片平滑返回原漂浮位置

### 用户控制与定制

**FR22:** 用户可以从预设的颜色主题中选择树的配色方案

**FR23:** 用户可以调整粒子数量（影响视觉密度和性能）

**FR24:** 用户可以查看当前的性能指标（FPS、粒子数）

**FR25:** 用户可以重置所有设置到默认值

**FR26:** 系统能够保存用户的偏好设置到本地存储（LocalStorage）

**FR27:** 系统能够在页面重新加载时恢复用户的偏好设置

### 相机与视角控制

**FR28:** 用户可以通过鼠标拖拽旋转相机视角（轨道控制）

**FR29:** 系统能够在爆炸后自动执行相机推进动画（Dolly In）

**FR30:** 用户可以通过鼠标滚轮或捏合手势缩放视角

**FR31:** 系统能够限制相机的旋转和缩放范围，保持最佳观看角度

### 响应式与设备支持

**FR32:** 系统能够在移动设备上支持触摸交互（点击触发爆炸）

**FR33:** 用户可以在移动设备上通过滑动手势旋转相机

**FR34:** 用户可以在移动设备上通过双指捏合手势缩放视角

**FR35:** 系统能够根据设备类型（桌面/移动）自动调整粒子数量和视觉效果质量

**FR36:** 系统能够在竖屏模式下自动调整视野（FOV）以保持树/照片在画面内

### 可访问性功能

**FR37:** 用户可以通过键盘 Tab 键循环选择漂浮的照片

**FR38:** 用户可以通过键盘 Enter 键打开选中的照片（Lightbox）

**FR39:** 用户可以通过键盘 Esc 键关闭 Lightbox 或退出当前状态

**FR40:** 系统能够检测用户的"减少动画"偏好设置，并相应地禁用爆炸效果，使用简单淡入淡出

**FR41:** 系统能够为所有交互元素提供适当的 ARIA 标签和角色

---

## Non-Functional Requirements

### Performance

**NFR-P1: 帧率要求**
- 桌面设备（中高端）：保持 60 FPS
- 移动设备：保持至少 30 FPS
- 在粒子爆炸和形态转换的高负载时刻，允许短暂降至 45 FPS（桌面）/ 24 FPS（移动）

**NFR-P2: 加载性能**
- 首次内容绘制（FCP）< 1.5 秒
- 最大内容绘制（LCP）< 2.5 秒
- 所有照片资源加载完成 < 3 秒（假设 20 张照片，每张 < 200KB）

**NFR-P3: 内存使用**
- 总内存占用 < 500MB（包含所有纹理和 3D 对象）
- 无内存泄漏（长时间运行不应持续增长）

**NFR-P4: 响应时间**
- 用户交互响应延迟 < 100 毫秒
- 状态转换动画启动延迟 < 50 毫秒

**NFR-P5: 资源优化**
- 照片纹理自动压缩和调整大小（最大 1024x1024）
- 使用纹理图集减少 GPU 调用
- 粒子系统使用实例化渲染（Instanced Rendering）

### Accessibility

**NFR-A1: 键盘导航**
- 所有核心功能必须可通过键盘访问
- 焦点指示器清晰可见
- 逻辑的 Tab 顺序

**NFR-A2: 动画偏好**
- 完全支持 `prefers-reduced-motion` 媒体查询
- 减少动画模式下，使用简单的淡入淡出替代复杂动画

**NFR-A3: 触摸目标**
- 移动端所有可点击元素最小尺寸 44x44 像素
- 足够的间距防止误触

**NFR-A4: 语义化 HTML**
- 使用适当的 ARIA 角色和标签
- 屏幕阅读器友好的内容结构

### Compatibility

**NFR-C1: 浏览器支持**
- Chrome 90+（完全支持）
- Firefox 88+（完全支持）
- Safari 14+（完全支持）
- Edge 90+（完全支持）
- 必须支持 WebGL 2.0

**NFR-C2: 设备支持**
- 桌面：Windows, macOS, Linux
- 移动：iOS 14+, Android 10+
- 平板：iPad, Android 平板

**NFR-C3: 屏幕尺寸**
- 最小支持分辨率：375x667（iPhone SE）
- 最大测试分辨率：2560x1440（2K 显示器）
- 响应式布局适配所有中间尺寸

**NFR-C4: WebGL 降级**
- 检测 WebGL 支持，不支持时显示友好的错误消息
- 提供替代内容或建议升级浏览器

### Reliability

**NFR-R1: 错误处理**
- 纹理加载失败时使用占位符图像
- Three.js 渲染错误时显示错误边界（Error Boundary）
- 所有错误记录到控制台便于调试

**NFR-R2: 稳定性**
- 应用在正常使用下不应崩溃
- 状态管理健壮，防止无效状态

**NFR-R3: 数据持久性**
- 用户设置可靠地保存到 LocalStorage
- LocalStorage 失败时优雅降级（使用默认设置）

---

_This PRD captures the essence of Christmas-tree - 一个将节日魔法与个人记忆完美融合的情感化 3D 交互体验，通过创新的粒子动画和沉浸式设计，为用户创造难忘的视觉和情感旅程。_

_Created through collaborative discovery between Gianni and AI facilitator._

