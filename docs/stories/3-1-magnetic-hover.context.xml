<story-context id="3-1-magnetic-hover.context" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>1</storyId>
    <title>Magnetic Hover & Camera Drift</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-05</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/3-1-magnetic-hover.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>User</asA>
    <iWant>the photos to drift gently and respond to my mouse with a magnetic hover effect</iWant>
    <soThat>the memory cloud feels alive, immersive, and responsive to my interaction</soThat>
    <tasks>
      - Implement Camera Drift Logic (AC: 4)
      - Implement Magnetic Hover on PolaroidPhoto (AC: 1, 3)
      - Implement 3D Tilt Interaction (AC: 2)
      - Verify Performance & Feel
    </tasks>
  </story>

  <acceptanceCriteria>
    1. **Magnetic Hover:** When hovering a floating photo, it must visually "react" with smooth transition: scale up to 1.5x, significantly slow down its rotation, and dynamically tilt in 3D space. [Source: docs/stories/tech-spec-epic-3.md#acceptance-criteria-authoritative]
    2. **3D Tilt Interaction:** The photo card must tilt dynamically as the mouse moves over it, creating a natural physical interaction where tilt angles (X/Y) smoothly follow the mouse position relative to the card center. [Source: docs/stories/tech-spec-epic-3.md#acceptance-criteria-authoritative]
    3. **Cursor Feedback:** The cursor uses the standard pointer when hovering a photo (no custom icon) to keep focus on the simulation. [Source: docs/stories/tech-spec-epic-3.md#acceptance-criteria-authoritative]
    4. **Camera Drift:** When the user is inactive (no interaction), the camera slowly "Dollies In" towards the center of the cloud to create a sense of movement. [Source: docs/stories/tech-spec-epic-3.md#acceptance-criteria-authoritative]
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/stories/tech-spec-epic-3.md</path>
        <title>Epic 3 Tech Spec</title>
        <section>Detailed Design - Workflows</section>
        <snippet>Viewing a Memory: User hovers particle -> `hoveredPhotoId` set. Photo scales to 1.5x with smooth transition, rotation slows down, and card tilts dynamically based on mouse position to simulate realistic Polaroid card physics.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>2.2 Novel UX Patterns</section>
        <snippet>The Capture (Selection): Hovered photo slows down rotation and slightly scales up (1.1x) to prevent frustration from "chasing" moving targets. Note: Tech spec updated this to 1.5x and added tilt.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Decision Document</title>
        <section>5. Novel Pattern Designs - Hybrid Interaction</section>
        <snippet>Hybrid Interaction Pattern: Interaction Logic handles raycasting on Points or Mesh instances. For Epic 3, we interact with the instances spawned in Story 2.3.</snippet>
      </doc>
    </docs>
    <code>
      <item>
        <path>src/components/canvas/PolaroidPhoto.tsx</path>
        <kind>component</kind>
        <symbol>PolaroidPhoto</symbol>
        <lines>67-76, 236-278</lines>
        <reason>Core component for photo visualization. Needs hover logic (scale/tilt) and mouse move handling added to the mesh.</reason>
      </item>
      <item>
        <path>src/components/canvas/Experience.tsx</path>
        <kind>component</kind>
        <symbol>Experience</symbol>
        <lines>66-74</lines>
        <reason>Contains OrbitControls. Needs modification or wrapping to implement "Camera Drift" (Dolly In) when idle.</reason>
      </item>
      <item>
        <path>src/store/useStore.ts</path>
        <kind>store</kind>
        <symbol>useStore</symbol>
        <lines>40-66</lines>
        <reason>Global state. Tech spec considers adding `hoveredPhotoId`, but dev notes suggest keeping hover state local to component to avoid performance hit (re-rendering all photos on one hover).</reason>
      </item>
    </code>
    <dependencies>
      <dep>framer-motion</dep>
      <dep>@react-three/fiber</dep>
      <dep>three</dep>
    </dependencies>
  </artifacts>

  <constraints>
    <performance>
      - Maintain >30fps (desktop target 60fps) during hover transitions.
      - Avoid global state updates on `mousemove` (tilt effect) to prevent react-tree-wide re-renders. Use `useFrame` and refs for tilt animation.
    </performance>
    <architecture>
      - Use "Hybrid Interaction" as established in Story 2.3 - `PolaroidPhoto` is a `Group` containing Meshes, not a particle. Standard DOM events (onPointerOver, etc.) work on these meshes.
    </architecture>
    <interaction>
      - Drift must be subtle and pause when user is actively controlling camera (orbiting).
    </interaction>
  </constraints>

  <interfaces>
    <interface>
      <name>onPointerMove</name>
      <kind>Event Handler</kind>
      <signature>(e: ThreeEvent&lt;PointerEvent&gt;) =&gt; void</signature>
      <path>src/components/canvas/PolaroidPhoto.tsx</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Use manual visual verification for interaction "feel". Unit tests for logic if extracted to hooks.</standards>
    <locations>src/components/canvas</locations>
    <ideas>
      - Test Idea 1: Verify scale goes to 1.5x on hover and returns to 1.0x on out.
      - Test Idea 2: Verify tilt follows mouse movement relative to center.
      - Test Idea 3: Verify camera moves along Z/Forward vector when idle in Exploded state.
    </ideas>
  </tests>
</story-context>
