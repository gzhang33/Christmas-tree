<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>3</storyId>
    <title>UI Component Refactor (Tailwind + Framer)</title>
    <status>drafted</status>
    <generatedAt>2025-12-01</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-3-ui-refactor.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>User</asA>
    <iWant>to see a polished, responsive control panel</iWant>
    <soThat>I can customize the tree using the new "Midnight Magic" design system.</soThat>
    <tasks>
      - [ ] Refactor `Controls.tsx` to use Tailwind CSS classes (AC: 1, 2)
      - [ ] Implement "Midnight Magic" color palette
      - [ ] Integrate `useStore` in `Controls.tsx` (AC: 3)
      - [ ] Connect `theme` selector to global store
      - [ ] Connect `particleCount` slider to global store
      - [ ] Connect `isExploded` state for visibility
      - [ ] Implement Framer Motion transitions (AC: 4)
      - [ ] Wrap controls in `AnimatePresence`
      - [ ] Add fade-out animation on explosion
      - [ ] Add ARIA labels to all buttons and inputs (AC: 5)
      - [ ] Verify responsive design (mobile/desktop)
      - [ ] Verify accessibility (keyboard nav)
    </tasks>
  </story>

  <acceptanceCriteria>
    1. `src/components/ui/Controls.tsx` is refactored to use Tailwind CSS.
    2. UI matches "Midnight Magic" theme (Neon Pink/Purple on Dark Slate).
    3. `Controls` component uses `useStore` for state management (removing local useState/props where applicable).
    4. `Controls` component uses `framer-motion`'s `AnimatePresence` to fade out when `isExploded` is true.
    5. All interactive elements have appropriate ARIA labels.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/prd.md</path>
        <title>Product Requirements Document</title>
        <section>Functional Requirements</section>
        <snippet>FR22-27: User control and customization requirements. FR41: Accessibility requirements. FR12: Immersion mode (hide UI on explosion).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Decision Document</title>
        <section>Decision Summary Table</section>
        <snippet>Use Tailwind CSS for styling. Use Zustand for state management. Use Framer Motion for UI transitions.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>3.1 Color System</section>
        <snippet>Midnight Magic Theme: Primary #D53F8C, Secondary #805AD5, Background #1A202C. Font: Inter.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 1.3: UI Component Refactor</section>
        <snippet>Refactor Controls.tsx to use Tailwind CSS. Integrate useStore. Implement Framer Motion transitions.</snippet>
      </doc>
    </docs>
    <code>
      <item>
        <path>src/components/ui/Controls.tsx</path>
        <kind>component</kind>
        <symbol>Controls</symbol>
        <lines>1-200</lines>
        <reason>Target component to refactor.</reason>
      </item>
      <item>
        <path>src/store/useStore.ts</path>
        <kind>store</kind>
        <symbol>useStore</symbol>
        <lines>1-37</lines>
        <reason>Global state store to integrate.</reason>
      </item>
    </code>
    <dependencies>
      <dep name="zustand" version="^5.0.9" />
      <dep name="framer-motion" version="^12.23.25" />
      <dep name="tailwindcss" version="^4.1.17" />
      <dep name="lucide-react" version="^0.395.0" />
    </dependencies>
  </artifacts>

  <constraints>
    - Strict separation: UI components must not contain R3F hooks.
    - Use `useStore` for state management.
    - Use `framer-motion` for UI transitions (AnimatePresence).
    - Match "Midnight Magic" theme colors exactly.
    - Ensure all interactive elements have ARIA labels.
  </constraints>

  <interfaces>
    <interface>
      <name>AppState</name>
      <kind>Zustand Store Interface</kind>
      <signature>
        interface AppState {
            theme: string;
            particleCount: number;
            isExploded: boolean;
            activePhotoId: string | null;
            setTheme: (theme: string) => void;
            setParticleCount: (count: number) => void;
            triggerExplosion: () => void;
            resetExplosion: () => void;
            setActivePhoto: (id: string | null) => void;
        }
      </signature>
      <path>src/store/useStore.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Verify state updates using the DebugStore component. Ensure visual transitions match the UX spec (smooth fade out). Verify accessibility using browser dev tools.
    </standards>
    <locations>
      src/components/DebugStore.tsx
    </locations>
    <ideas>
      - Toggle `isExploded` and verify Controls component unmounts/fades out.
      - Change theme color and verify global state update.
      - Verify all buttons have `aria-label` attributes.
    </ideas>
  </tests>
</story-context>
